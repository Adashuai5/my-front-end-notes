{"root":{"data":{"id":"6634a75cae95","created":1612711442,"text":"浏览器工作原理","expandState":"expand"},"children":[{"data":{"id":"c94toxg9qjk0","created":1612855877639,"text":"宏观视角浏览器","expandState":"expand","layout":null},"children":[{"data":{"id":"c93ejci7kf40","created":1612711563618,"text":"浏览器架构","expandState":"expand","layout":null},"children":[{"data":{"id":"c93ejoqfjhs0","created":1612711590236,"text":"进程和线程","expandState":"collapse","layout":null},"children":[{"data":{"id":"c93emnxc4y00","created":1612711823569,"text":" ","expandState":"expand","image":"https://kityminder-img.gz.bcebos.com/66ddf425b61c457db3afe43cd0fc3a7efaab6327","imageTitle":"","imageSize":{"width":200,"height":100},"layout":null},"children":[{"data":{"id":"c93eo6ca49c0","created":1612711942019,"text":"多线程并行处理（同一时刻处理多个任务）","expandState":"expand","layout":null},"children":[]}]},{"data":{"id":"c93elnteph40","created":1612711744968,"text":"进程","layout":null},"children":[{"data":{"id":"c93elzpznsw0","created":1612711770882,"text":"启动程序，操作系统为程序创建的内存（运行环境）","expandState":"expand","layout":null},"children":[{"data":{"id":"c93emt52t7c0","created":1612711834921,"text":"一个执行任务的主线程","layout":null},"children":[]},{"data":{"id":"c93es1xo63k0","created":1612712245885,"text":"存放代码、运行中的数据","layout":null},"children":[]}]}]},{"data":{"id":"c93esbuml280","created":1612712267469,"text":"关系","layout":null,"expandState":"expand"},"children":[{"data":{"id":"c93esi4i36g0","created":1612712281127,"text":"任意一线程执行出错，都会导致整个进程的崩溃","layout":null},"children":[]},{"data":{"id":"c93esop7hu00","created":1612712295440,"text":"线程间共享进程中数据","image":"https://kityminder-img.gz.bcebos.com/d0fd245af423da384424fa8f5c3a9e7667cd96a3","imageTitle":"","imageSize":{"width":200,"height":138},"layout":null},"children":[]},{"data":{"id":"c93esoxsmvc0","created":1612712295959,"text":"当一个进程关闭之后，操作系统会回收进程所占用的内存","layout":null},"children":[]},{"data":{"id":"c93etbzws9c0","created":1612712346153,"text":"进程之间的内容相互隔离","layout":null},"children":[]}]}]},{"data":{"id":"c93ga8g37uw0","created":1612716491725,"text":"单进程浏览器时代","image":"https://kityminder-img.gz.bcebos.com/653e24ad15d5af5d93da2655da42a10c1a023b4c","imageTitle":"","imageSize":{"width":200,"height":82},"expandState":"collapse","layout":null},"children":[{"data":{"id":"c93gc7jcmmo0","created":1612716646473,"text":"不稳定","expandState":"expand","layout":null},"children":[{"data":{"id":"c93gcpy16zk0","created":1612716686543,"text":"插件的意外崩溃——整个浏览器的崩溃","layout":null},"children":[]},{"data":{"id":"c93gd0p1nyw0","created":1612716709944,"text":"复杂的JavaScript代码——引起渲染引擎模块的崩溃——整个浏览器的崩溃","layout":null},"children":[]}]},{"data":{"id":"c93gccwwcps0","created":1612716658176,"text":"不流畅","expandState":"expand","layout":null},"children":[{"data":{"id":"c93gdzyfqjk0","created":1612716786700,"text":"无限循环脚本","layout":null},"children":[]},{"data":{"id":"c93gdxko9880","created":1612716781514,"text":"内存泄漏","expandState":"expand","layout":null},"children":[]}]},{"data":{"id":"c93getudc9s0","created":1612716851757,"text":"不安全","layout":null},"children":[{"data":{"id":"c93gf0j7qkw0","created":1612716866320,"text":"恶意插件","layout":null},"children":[]},{"data":{"id":"c93gf9zqy680","created":1612716886911,"text":"恶意脚本","layout":null},"children":[]}]}]},{"data":{"id":"c93gfg2tql40","created":1612716900158,"text":"多进程浏览器时代","expandState":"collapse","layout":null},"children":[{"data":{"id":"c93gflfq32o0","created":1612716911821,"text":"早期多进程架构","layout":null},"children":[{"data":{"id":"c93gftwt1cw0","created":1612716930269,"text":"2008年Chrome发布时的进程架构","image":"https://kityminder-img.gz.bcebos.com/a6003072c21e9b41ebf4878fc39bf46f2a4f2d72","imageTitle":"","imageSize":{"width":200,"height":126},"layout":null},"children":[{"data":{"id":"c93gggiu2200","created":1612716979490,"text":"进程是相互隔离——插件崩溃只影响当前页面——解决不稳定","layout":null},"children":[]},{"data":{"id":"c93ghfl2cpc0","created":1612717055812,"text":"渲染进程也只影响当前页面（解决无限循环脚本）；页面关闭释放内存（解决内存泄露）——解决不流畅","layout":null},"children":[]},{"data":{"id":"c93giolvyy00","created":1612717153817,"text":"使用安全沙箱——无法读取数据——解决不安全","layout":null},"children":[]}]},{"data":{"id":"c93gj8436740","created":1612717196276,"text":"当前多进程架构","image":"https://kityminder-img.gz.bcebos.com/f63b94d06ec92c35c757deb7b2d0bf1be0a40695","imageTitle":"","imageSize":{"width":200,"height":86},"layout":null},"children":[{"data":{"id":"c93gjr2zhaw0","created":1612717237569,"text":"浏览器进程：界面显示、用户交互、子进程管理，同时提供存储等功能","layout":null},"children":[]},{"data":{"id":"c93gk2gi10g0","created":1612717262330,"text":"渲染进程","layout":null},"children":[{"data":{"id":"c93gluhmbmw0","created":1612717401712,"text":"将 HTML、CSS 和 JavaScript 转换为可以交互网页（核心任务）","layout":null},"children":[]},{"data":{"id":"c93glza8big0","created":1612717412149,"text":"排版引擎Blink和JavaScript引擎V8都是运行在该进程中","layout":null},"children":[]},{"data":{"id":"c93glzdsvhc0","created":1612717412365,"text":"每个Tab标签创建一个渲染进程（默认情况下）","layout":null},"children":[]},{"data":{"id":"c93gm6fogrs0","created":1612717427716,"text":"运行在沙箱模式下（安全考虑）","layout":null},"children":[]}]},{"data":{"id":"c93gmbz8azs0","created":1612717439782,"text":"GPU进程","layout":null},"children":[{"data":{"id":"c93gmh6l1340","created":1612717451111,"text":"GPU初衷是为了实现3D CSS的效果","layout":null},"children":[]},{"data":{"id":"c93gmoob24o0","created":1612717467420,"text":"随后网页、Chrome的UI界面都选择采用GPU来绘制","layout":null},"children":[]},{"data":{"id":"c93gmvtrz2g0","created":1612717482988,"text":"最后，Chrome在其多进程架构上也引入了GPU进程","layout":null},"children":[]}]},{"data":{"id":"c93gn1va3340","created":1612717496140,"text":"网络进程：负责页面的网络资源加载，之前是作为一个模块运行在浏览器进程里面的，最近才独立出来，成为一个单独的进程","layout":null},"children":[]},{"data":{"id":"c93gnkgqeq80","created":1612717536619,"text":"插件进程：负责插件的运行，通过插件进程来隔离，以保证插件进程崩溃不会对浏览器和页面造成影响","layout":null},"children":[]}]}]},{"data":{"id":"c93gogdshm00","created":1612717606098,"text":"未来面向服务的架构","layout":null},"children":[{"data":{"id":"c93goqe4lrk0","created":1612717627886,"text":"2016年，Chrome “面向服务的架构”（Services Oriented Architecture，简称SOA）","image":"https://kityminder-img.gz.bcebos.com/c8edfb82b38a2b7740f413c932c04b6819093b47","imageTitle":"","imageSize":{"width":200,"height":101},"expandState":"expand","layout":null},"children":[{"data":{"id":"c93grc1yv6w0","created":1612717831769,"text":"每个服务（Service）都可以在独立的进程中运行，访问服务（Service）必须使用定义好的接口，通过IPC来通信——构建一个更内聚、松耦合、易于维护和扩展的系统","layout":null},"children":[]},{"data":{"id":"c93gq4jam7c0","created":1612717737038,"text":"灵活的弹性架构","layout":null},"children":[{"data":{"id":"c93gqhvksgo0","created":1612717766079,"text":"强大性能设备上会以多进程的方式运行基础服务","layout":null},"children":[]},{"data":{"id":"c93gqlanols0","created":1612717773521,"text":"在资源受限的设备上，Chrome会将多服务整合到一个进程中，从而节省内存占用","image":"https://kityminder-img.gz.bcebos.com/3928aa8fddb12453a2ef0753c718a69061f7db8d","imageTitle":"","imageSize":{"width":200,"height":110},"layout":null},"children":[]}]}]}]}]}]},{"data":{"id":"c94tpiqqu0w0","created":1612855923985,"text":"TCP协议","expandState":"collapse","layout":null},"children":[{"data":{"id":"c94trdm2v2g0","created":1612856069547,"text":"一个数据包的“旅程”","layout":null},"children":[{"data":{"id":"c94trxsxit40","created":1612856113497,"text":"1. 网际协议（Internet Protocol，简称IP）：把数据包送达目的主机","image":"https://kityminder-img.gz.bcebos.com/bf8c1341cfa1c002774ea3324a7cc45dee2c1f08","imageTitle":"","imageSize":{"width":200,"height":123},"note":"IP头是IP数据包开头的信息，包含IP版本、源IP地址、目标IP地址、生存时间等信息","layout":null},"children":[]},{"data":{"id":"c94twzlr1w80","created":1612856509237,"text":"2. 用户数据包协议（User Datagram Protocol，简称UDP）：把数据包送达应用程序","image":"https://kityminder-img.gz.bcebos.com/a073b6acf0fe62e4617fcd1f727ee648b0ffbf9f","imageTitle":"","imageSize":{"width":200,"height":142},"note":"UDP中一个最重要的信息是端口号（一个数字），每个想访问网络的程序都需要绑定一个端口号。UDP通过端口号把指定的数据包发送给指定的程序\nIP通过IP地址信息把数据包发送给指定的电脑，而UDP通过端口号把数据包分发给正确的程序。\n和IP头一样，端口号会被装进UDP头里面，UDP头再和原始数据包合并组成新的UDP数据包。UDP头中除了目的端口，还有源端口号等信息","layout":null},"children":[]},{"data":{"id":"c94tx0k5s7k0","created":1612856511318,"text":"3. TCP（Transmission Control Protocol，传输控制协议）：把数据完整地送达应用程序","image":"https://kityminder-img.gz.bcebos.com/2854bf4a5baa04e46c09cd37b2cabac3dd38da1f","imageTitle":"","imageSize":{"width":200,"height":139},"layout":null},"children":[{"data":{"id":"c94u4rm3go80","created":1612857118757,"text":"UDP传输存的问题","layout":null},"children":[{"data":{"id":"c94u575wjqw0","created":1612857152606,"text":"1. 数据包在传输过程中容易丢失","layout":null},"children":[]},{"data":{"id":"c94u5bfkgh40","created":1612857161898,"text":"2. 大文件会被拆分成很多小的数据包来传输，这些小的数据包会经过不同的路由，并在不同的时间到达接收端，而UDP协议并不知道如何组装这些数据包，从而把这些数据包还原成完整的文件","layout":null},"children":[]}]},{"data":{"id":"c94u5mmhfyg0","created":1612857186261,"text":"TCP如何解决","layout":null},"children":[{"data":{"id":"c94u5w1ri600","created":1612857206776,"text":"1. 对于数据包丢失的情况，TCP提供重传机制","layout":null},"children":[]},{"data":{"id":"c94u5zqr0m80","created":1612857214817,"text":"2. TCP引入了数据包排序机制，用来保证把乱序的数据包组合成一个完整的文件","layout":null},"children":[]}]},{"data":{"id":"c94u7byh93k0","created":1612857319770,"text":"完整的TCP连接过程","image":"https://kityminder-img.gz.bcebos.com/b1c108a31e64ead9571120a362033ba0f8c06324","imageTitle":"","imageSize":{"width":200,"height":71},"layout":null},"children":[{"data":{"id":"c94u7mxtqbs0","created":1612857343675,"text":"1. 建立连接阶段","note":"通过“三次握手”来建立客户端和服务器之间的连接。\nTCP提供面向连接的通信传输。面向连接是指在数据通信开始之前先做好两端之间的准备工作。\n所谓三次握手，是指在建立一个TCP连接时，客户端和服务器总共要发送三个数据包以确认连接的建立","layout":null},"children":[]},{"data":{"id":"c94u7notxao0","created":1612857345308,"text":"2. 传输数据阶段","note":"接收端需要对每个数据包进行确认操作：接收端在接收到数据包之后，需要发送确认数据包给发送端。\n当发送端发送了一个数据包之后，在规定时间内没有接收到接收端反馈的确认消息，则判断为数据包丢失，触发发送端重发机制。\n同样，一个大的文件在传输过程中会被拆分成很多小的数据包，这些数据包到达接收端后，接收端会按照TCP头中的序号为其排序，从而保证组成完整的数据","layout":null},"children":[]},{"data":{"id":"c94u7oetvyo0","created":1612857346880,"text":"3. 断开连接阶段","note":"数据传输完毕之后，就要终止连接了，涉及到最后一个阶段“四次挥手”来保证双方都能断开连接","layout":null},"children":[]}]}]}]}]},{"data":{"id":"c94uapbjqhs0","created":1612857583951,"text":"HTTP请求流程","image":"https://kityminder-img.gz.bcebos.com/c9a6b675eddf46b767a902509089346996e88223","imageTitle":"","imageSize":{"width":200,"height":74},"expandState":"collapse","layout":null},"children":[{"data":{"id":"c94ub1myj6w0","created":1612857610762,"text":"浏览器端发起HTTP请求流程","image":"https://kityminder-img.gz.bcebos.com/dd5bfc616aa15d1d4cebf269cf531a3fca28cd12","imageTitle":"","imageSize":{"width":200,"height":99},"layout":null},"children":[{"data":{"id":"c94ucskxpvk0","created":1612857747777,"text":"1. 构建请求——GET /index.html HTTP1.1","layout":null},"children":[]},{"data":{"id":"c94ucv6t6b40","created":1612857753453,"text":"2. 查找缓存","layout":null},"children":[{"data":{"id":"c9ddh0rmafc0","created":1613724159794,"text":"有缓存","layout":null},"children":[{"data":{"id":"c9ddhezpe5c0","created":1613724190757,"text":"拦截请求，返回缓存数据","layout":null},"children":[]}]}]},{"data":{"id":"c9ddgor21m80","created":1613724133638,"text":"3. 准备IP地址和端口","layout":null},"children":[{"data":{"id":"c9ddgpjc1a80","created":1613724135348,"text":"利用URL地址","layout":null},"children":[{"data":{"id":"c9ddkyshyb40","created":1613724468950,"text":"获取IP地址","layout":null},"children":[{"data":{"id":"c9ddjkhtveg0","created":1613724359466,"text":"DNS（Domain Name System 域名系统）解析——把域名解析为对应 IP，也有数据缓存","layout":null},"children":[]}]},{"data":{"id":"c9ddl9jy2fk0","created":1613724492377,"text":"获取端口（默认80）","layout":null},"children":[]},{"data":{"id":"c9ddlltfkj40","created":1613724519072,"text":"分支主题","layout":null},"children":[]}]}]},{"data":{"id":"c9ddgouqkio0","created":1613724133861,"text":"4. 等待TCP队列","layout":null},"children":[{"data":{"id":"c9ddnocnf8o0","created":1613724681316,"text":"Chrome 机制，同一域名同时最多只能建立6个TCP连接，超出需等待","layout":null},"children":[]}]},{"data":{"id":"c9ddo88fvnk0","created":1613724724597,"text":"5. 建立TCP连接","layout":null},"children":[]},{"data":{"id":"c9ddo9d87g80","created":1613724727064,"text":"6. 发送HTTP请求","image":"https://kityminder-img.gz.bcebos.com/ce5b4304c42c3c9eea98d7bf7e5f93fc7ae1cad1","imageTitle":"","imageSize":{"width":200,"height":114},"layout":null},"children":[]}]},{"data":{"id":"c9dguh7mox40","created":1613733677654,"text":"服务器端处理HTTP请求流程","layout":null},"children":[{"data":{"id":"c9dgw92o0280","created":1613733816668,"text":"1. 返回请求——curl -i  https://time.geekbang.org/","image":"https://kityminder-img.gz.bcebos.com/c71cbeffdfbce966c297e0a5468a691192866408","imageTitle":"","imageSize":{"width":200,"height":114},"layout":null},"children":[]},{"data":{"id":"c9dgwp7vza80","created":1613733851812,"text":"2. 断开连接","expandState":"expand","layout":null},"children":[{"data":{"id":"c9dgwsz9zko0","created":1613733859999,"text":"设置了 Connection:Keep-Alive ——保持TCP连接","expandState":"expand","layout":null},"children":[]}]},{"data":{"id":"c9dh269rd340","created":1613734280753,"text":"3. 重定向——curl -I geekbang.org","image":"https://kityminder-img.gz.bcebos.com/496022c408f416d31ea6b326f8542dc822aa9976","imageTitle":"","imageSize":{"width":200,"height":98},"layout":null},"children":[]}]},{"data":{"id":"c9dh407hvaw0","created":1613734424282,"text":"问题解答","layout":null},"children":[{"data":{"id":"c9dh48faiwg0","created":1613734442168,"text":"1. 为什么很多站点第二次打开速度会很快？（Cache）","layout":null},"children":[{"data":{"id":"c9dh84nz5nc0","created":1613734747443,"text":"通过 Cache-Control中的 Max-age 参数及 If-None-Match 配合设置浏览器缓存","image":"https://kityminder-img.gz.bcebos.com/c1cc890b5c929ec4ca3781e1956d4a5092c7ed33","imageTitle":"","imageSize":{"width":174,"height":200},"layout":null},"children":[]}]},{"data":{"id":"c9dh6i7z0rk0","created":1613734620222,"text":"2. 登录状态是如何保持的？（Cookie）","layout":null},"children":[{"data":{"id":"c9dhaids1t40","created":1613734934029,"text":"服务器端的响应头内有 Set-Cookie 字段，客户端保存该字段的内容，在下次请求中，自动在请求头中加入 Cookie 值。服务器端发现发送过来的 Cookie 后，会去检查连接请求的客户端，对比服务器上的记录，获取该用户的状态信息","image":"https://kityminder-img.gz.bcebos.com/c8902e24dadfcbd3de755c43b4a6de871b470472","imageTitle":"","imageSize":{"width":200,"height":163},"layout":null},"children":[]}]}]}]},{"data":{"id":"c9e1p812qsg0","created":1613792509154,"text":"导航流程","image":"https://kityminder-img.gz.bcebos.com/03a28e12a6dae8a3c46e75a388059d98f6933be1","imageTitle":"","imageSize":{"width":200,"height":83},"expandState":"collapse","layout":null},"children":[{"data":{"id":"c9e1v427vls0","created":1613792970701,"text":"从输入URL到页面展示","expandState":"expand","layout":null},"children":[{"data":{"id":"c9e1v857u4g0","created":1613792979589,"text":"1. 用户输入","layout":null},"children":[{"data":{"id":"c9e1viif7dc0","created":1613793002156,"text":"搜索","layout":null},"children":[{"data":{"id":"c9e1vq2xs3k0","created":1613793018634,"text":"地址栏使用浏览器默认搜索引擎，合成新的带搜索关键字的URL","layout":null},"children":[]}]},{"data":{"id":"c9e1w32glg00","created":1613793046903,"text":"符合URL规则","layout":null},"children":[{"data":{"id":"c9e1w6k3bm80","created":1613793054499,"text":"如 time.geekbang.org 址栏会根据规则加上协议，合成为完整的URL，如 https://time.geekbang.org","layout":null},"children":[]}]}]},{"data":{"id":"c9e1v956r7c0","created":1613792981764,"text":"2. URL请求过程","layout":null},"children":[{"data":{"id":"c9e228v75l40","created":1613793529710,"text":"浏览器进程通过进程间通信（IPC）把URL请求发送至网络进程","layout":null},"children":[{"data":{"id":"c9e22vp62e80","created":1613793579411,"text":"网络进程会查找本地缓存是否缓存了该资源","layout":null},"children":[{"data":{"id":"c9e236tr7zc0","created":1613793603633,"text":"有资源——直接返回资源给浏览器进程","layout":null},"children":[]},{"data":{"id":"c9e23bewbfk0","created":1613793613618,"text":"进入网络请求流程","layout":null},"children":[{"data":{"id":"c9e23ggbmm80","created":1613793624588,"text":"DNS解析","layout":null},"children":[{"data":{"id":"c9e41kg3uco0","created":1613799118774,"text":"获取IP地址","layout":null},"children":[]},{"data":{"id":"c9e41okgs8o0","created":1613799127745,"text":"HTTPS 则建立TLS连接","layout":null},"children":[]}]},{"data":{"id":"c9e43pk34y80","created":1613799286627,"text":"建立TCP连接","layout":null},"children":[]},{"data":{"id":"c9e4456gg800","created":1613799320631,"text":"浏览器端构建请求行、请求头（附加 Cookie 等数据）等信息向服务器发送","layout":null},"children":[]},{"data":{"id":"c9e47nyujhk0","created":1613799596623,"text":"服务器接收到后，根据请求信息生成响应数据（包括响应行、响应头和响应体等），并发给网络进程","layout":null},"children":[]},{"data":{"id":"c9e484wbzog0","created":1613799633476,"text":"网络进程接收了响应行和响应头之后，就开始解析","layout":null},"children":[{"data":{"id":"c9e49o0jq0g0","created":1613799753454,"text":"服务器返回 301/302 ——重定向","layout":null},"children":[{"data":{"id":"c9e4a6bk1fs0","created":1613799793301,"text":"从响应头的 Location 字段里面读取重定向的地址","layout":null},"children":[]}]},{"data":{"id":"c9e4av1m6s80","created":1613799847120,"text":"200——响应数据类型处理","layout":null},"children":[{"data":{"id":"c9e4b9bxl480","created":1613799878219,"text":"根据响应头 Content-Type 的值来决定如何显示响应体","layout":null},"children":[{"data":{"id":"c9e4ct7c0rk0","created":1613799999840,"text":"为 application/octet-stream","image":"https://kityminder-img.gz.bcebos.com/39a6abbf0d205b6763c96ffb4eed5fd3e56ae777","imageTitle":"","imageSize":{"width":200,"height":76},"layout":null},"children":[{"data":{"id":"c9e4d5sfvp40","created":1613800027238,"text":"浏览器判断为下载类型，请求被提交给下载管理器，请求的导航流程结束","layout":null},"children":[]}]},{"data":{"id":"c9e4ew6721s0","created":1613800163030,"text":"text/html","image":"https://kityminder-img.gz.bcebos.com/5919b29fddd59306c06569f999e98c7c3a349c12","imageTitle":"","imageSize":{"width":200,"height":98},"layout":null},"children":[{"data":{"id":"c9e4fz3nllc0","created":1613800247771,"text":"继续进行导航流程","layout":null},"children":[]}]}]}]}]}]}]}]}]},{"data":{"id":"c9e1v9ottqg0","created":1613792982952,"text":"3. 准备渲染进程","layout":null},"children":[{"data":{"id":"c9e4h0beal40","created":1613800328780,"text":"Chrome 默认策略：process-per-site-instance","layout":null},"children":[{"data":{"id":"c9e4i31ii5c0","created":1613800413077,"text":"每个标签对应一个渲染进程，同一站点（same-site，根域名（例如，geekbang.org）及协议相同）复用父页面进程","layout":null},"children":[]}]}]},{"data":{"id":"c9e4ooziu8g0","created":1613800931031,"text":"4. 提交文档（URL请求的响应体数据）","layout":null},"children":[{"data":{"id":"c9e4pd756yw0","created":1613800983735,"text":"浏览器进程发出“提交文档”消息，渲染进程接收后，会和网络进程建立传输数据的“管道”","layout":null},"children":[]},{"data":{"id":"c9e4q0czcbk0","created":1613801034153,"text":"文档数据传输完成后，渲染进程返回“确认提交”的消息给浏览器进程","layout":null},"children":[]},{"data":{"id":"c9e4qcy7gw00","created":1613801061558,"text":"浏览器进程收到“确认提交”消息后，更新浏览器界面状态","image":"https://kityminder-img.gz.bcebos.com/8f80299bbb4e726ae65bb00a1180c074bfd4fbbe","imageTitle":"","imageSize":{"width":200,"height":110},"layout":null},"children":[]}]},{"data":{"id":"c9e4qu78qv40","created":1613801099110,"text":"5. 渲染阶段","layout":null},"children":[]}]}]},{"data":{"id":"c9e4yvp8ng00","created":1613801729288,"text":"渲染流程","expandState":"collapse","layout":null},"children":[{"data":{"id":"c9e50zm34dc0","created":1613801894533,"text":"构建DOM树","image":"https://kityminder-img.gz.bcebos.com/4293e8af79ba3ca6d1cabca36fa5cd0018ed0bde","imageTitle":"","imageSize":{"width":200,"height":97},"layout":null},"children":[{"data":{"id":"c9e74r0in5k0","created":1613807831491,"text":"从HTML 生成保存在内存中，可以通过JavaScript来查询或修改的树状结构 DOM","layout":null},"children":[]}]},{"data":{"id":"c9e510htnbs0","created":1613801896452,"text":"样式计算","layout":null},"children":[{"data":{"id":"c9e75v53ws00","created":1613807918840,"text":"1. 把CSS转换为浏览器能够理解的结构——styleSheets","layout":null},"children":[]},{"data":{"id":"c9e770fagps0","created":1613808008704,"text":"2. 转换样式表中的属性值，使其标准化","image":"https://kityminder-img.gz.bcebos.com/fd07f94fbe729158af69f8ac576b5bc5a58c7a41","imageTitle":"","imageSize":{"width":200,"height":60},"layout":null},"children":[]},{"data":{"id":"c9e77pva1nk0","created":1613808064090,"text":"3. 计算出DOM树中每个节点的具体样式","layout":null},"children":[{"data":{"id":"c9e7b87w4pc0","created":1613808339127,"text":"遵守CSS的继承和层叠两个规则","layout":null},"children":[]},{"data":{"id":"c9e7bfdzssg0","created":1613808354734,"text":"最终输出的内容是每个DOM节点的样式，被保存在ComputedStyle的结构内","layout":null},"children":[]}]}]},{"data":{"id":"c9e7eetgchk0","created":1613808588584,"text":"布局阶段","expandState":"expand","layout":null},"children":[{"data":{"id":"c9e7enl7xbc0","created":1613808607677,"text":"1. 创建布局树","image":"https://kityminder-img.gz.bcebos.com/a362d8a352ba97e2320a005cc38ca1f0874a9158","imageTitle":"","imageSize":{"width":200,"height":172},"layout":null},"children":[{"data":{"id":"c9e7fclfio80","created":1613808662110,"text":"遍历DOM树中的所有可见节点，并把这些节点加到布局中","layout":null},"children":[]}]},{"data":{"id":"c9e7fv33j740","created":1613808702360,"text":"2. 布局计算","expandState":"expand","layout":null},"children":[{"data":{"id":"c9e7tqzau140","created":1613809790522,"text":"分层","expandState":"expand","layout":null},"children":[{"data":{"id":"c9e8ccxawdc0","created":1613811248845,"text":"为实现页面中有很多复杂的效果（如3D变换、页面滚动等），渲染引擎还需要为特定的节点生成专用的图层，并生成一棵对应的图层树（LayerTree）","image":"https://kityminder-img.gz.bcebos.com/06158792f30aff12e6866d75353a4def87777717","imageTitle":"","imageSize":{"width":200,"height":118},"expandState":"expand","layout":null},"children":[{"data":{"id":"c9e8nt8qpc80","created":1613812146371,"text":"1. 拥有层叠上下文属性的元素会被提升为单独的一层","image":"https://kityminder-img.gz.bcebos.com/4e19296e2aa5115d12e60b6c613d28af983cea37","imageTitle":"","imageSize":{"width":200,"height":105},"layout":null},"children":[]},{"data":{"id":"c9e8onfkrmg0","created":1613812212088,"text":"2. 需要剪裁（clip）的地方也会被创建为图层","image":"https://kityminder-img.gz.bcebos.com/9a0ea0cc638ccb44013e8c1cf26ccb4c7494d1ae","imageTitle":"","imageSize":{"width":200,"height":70},"layout":null},"children":[]}]}]},{"data":{"id":"c9e8qpt68m80","created":1613812373992,"text":"图层绘制","layout":null},"children":[{"data":{"id":"c9e8vqy7ec00","created":1613812768294,"text":"渲染引擎把一个图层的绘制拆分成很多小的绘制指令，按照顺序组成一个待绘制列表","image":"https://kityminder-img.gz.bcebos.com/c459d7c29f57ca783febd8f3ec996adc785fb323","imageTitle":"","imageSize":{"width":200,"height":105},"layout":null},"children":[]}]},{"data":{"id":"c9e8xn4u2ds0","created":1613812916716,"text":"栅格化（raster）操作","layout":null},"children":[{"data":{"id":"c9e8yp1gy9s0","created":1613812999230,"text":"绘制操作是由渲染引擎中的合成线程完成的","image":"https://kityminder-img.gz.bcebos.com/bc3ca56495d803460b570b969c4ddb1e9982bd29","imageTitle":"","imageSize":{"width":200,"height":81},"expandState":"expand","layout":null},"children":[{"data":{"id":"c9e910gu1c80","created":1613813180832,"text":"合成线程会将图层划分为图块（tile）","expandState":"expand","layout":null},"children":[{"data":{"id":"c9e96lua3zc0","created":1613813619179,"text":"通过快速栅格化（GPU 栅格化）","layout":null},"children":[]},{"data":{"id":"c9e95roh3sg0","created":1613813553524,"text":"按照视口附近的图块来优先生成位图","expandState":"expand","layout":null},"children":[]}]}]}]},{"data":{"id":"c9e9bxjtw0g0","created":1613814036488,"text":"合成和显示","layout":null},"children":[{"data":{"id":"c9e9cbblsio0","created":1613814066466,"text":"所有图块都被光栅化，合成线程就会生成绘制图块的命令——“DrawQuad”","layout":null},"children":[{"data":{"id":"c9e9cvsxzc00","created":1613814111050,"text":"浏览器进程里面的viz的组件，接收该命令","layout":null},"children":[{"data":{"id":"c9e9dfdqnzc0","created":1613814153667,"text":"将页面内容绘制到内存中，最后再将内存显示在屏幕上","layout":null},"children":[]}]}]}]}]}]},{"data":{"id":"c9e9fvft9d40","created":1613814345349,"text":"总结","image":"https://kityminder-img.gz.bcebos.com/57b8879ef21aba386e52743dc3a1ea08a61bc7b7","imageTitle":"","imageSize":{"width":200,"height":130},"layout":null},"children":[{"data":{"id":"c9e9ga1fsw00","created":1613814377131,"text":"渲染进程将HTML内容转换为能够读懂的DOM树结构。","layout":null},"children":[]},{"data":{"id":"c9e9gd1xobk0","created":1613814383692,"text":"渲染引擎将CSS样式表转化为浏览器可以理解的styleSheets，计算出DOM节点的样式。","layout":null},"children":[]},{"data":{"id":"c9e9gh5stuw0","created":1613814392632,"text":"创建布局树，并计算元素的布局信息。","layout":null},"children":[]},{"data":{"id":"c9e9gk6ufmo0","created":1613814399226,"text":"对布局树进行分层，并生成分层树。","layout":null},"children":[]},{"data":{"id":"c9e9gn2rrhk0","created":1613814405510,"text":"为每个图层生成绘制列表，并将其提交到合成线程。","layout":null},"children":[]},{"data":{"id":"c9e9gpzooq80","created":1613814411854,"text":"合成线程将图层分成图块，并在光栅化线程池中将图块转换成位图。","layout":null},"children":[]},{"data":{"id":"c9e9gs0788g0","created":1613814416239,"text":"合成线程发送绘制图块命令DrawQuad给浏览器进程。","layout":null},"children":[]},{"data":{"id":"c9e9gud7maw0","created":1613814421379,"text":"浏览器进程根据DrawQuad消息生成页面，并显示到显示器上","layout":null},"children":[]}]},{"data":{"id":"c9e9v0irdco0","created":1613815531873,"text":"相关概念","layout":null},"children":[{"data":{"id":"c9e9v32wdig0","created":1613815537445,"text":"1. 更新了元素的几何属性（重排）","image":"https://kityminder-img.gz.bcebos.com/ba44d10cf8f1fa3dc14820b6b141a25f9a628533","imageTitle":"","imageSize":{"width":200,"height":55},"layout":null},"children":[{"data":{"id":"c9e9wu8rphk0","created":1613815674937,"text":"通过JavaScript或者CSS修改元素的几何位置属性，浏览器会触发重新布局","layout":null},"children":[]}]},{"data":{"id":"c9e9w43nt0o0","created":1613815618032,"text":"2. 更新元素的绘制属性（重绘）","image":"https://kityminder-img.gz.bcebos.com/b57fa1319475d6c6e99eeaaa4c6fdc1a535ed1a0","imageTitle":"","imageSize":{"width":200,"height":50},"layout":null},"children":[{"data":{"id":"c9e9xrwsdqg0","created":1613815748223,"text":"相较于重排操作，重绘省去了布局和分层阶段","layout":null},"children":[]}]},{"data":{"id":"c9e9wgc18140","created":1613815644659,"text":"3. 直接合成阶段","layout":null},"children":[{"data":{"id":"c9e9ykeje880","created":1613815810246,"text":"更改一个既不要布局也不要绘制的属性","layout":null},"children":[{"data":{"id":"c9e9yspi9bk0","created":1613815828324,"text":"渲染引擎将跳过布局和绘制","layout":null},"children":[]}]}]}]}]}]}]},"template":"default","theme":"fresh-blue","version":"1.4.43"}